{% extends 'bookings/base.html' %}

{% block title %}Dashboard - TravelEase{% endblock %}

{% block content %}
<section class="py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="fw-bold">Welcome, {{ user.first_name|default:user.username }}!</h1>
                <p class="text-muted">Manage your bookings and profile</p>
            </div>
        </div>
        
        <div class="row">
            <!-- Profile Section -->
            <div class="col-lg-4 mb-4">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-user"></i> Profile Information</h5>
                    </div>
                    <div class="card-body">
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="mb-3">
                                <label for="{{ profile_form.phone_number.id_for_label }}" class="form-label">Phone Number</label>
                                {{ profile_form.phone_number }}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ profile_form.address.id_for_label }}" class="form-label">Address</label>
                                {{ profile_form.address }}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ profile_form.date_of_birth.id_for_label }}" class="form-label">Date of Birth</label>
                                {{ profile_form.date_of_birth }}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ profile_form.passport_number.id_for_label }}" class="form-label">Passport Number</label>
                                {{ profile_form.passport_number }}
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Update Profile
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Bookings Section -->
            <div class="col-lg-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-calendar-check"></i> My Bookings</h5>
                    </div>
                    <div class="card-body">
                        {% if user_bookings %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Booking ID</th>
                                            <th>Package</th>
                                            <th>Travel Date</th>
                                            <th>Travelers</th>
                                            <th>Total Price</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for booking in user_bookings %}
                                        <tr>
                                            <td><strong>#{{ booking.id }}</strong></td>
                                            <td>
                                                <div>
                                                    <strong>{{ booking.package.name }}</strong><br>
                                                    <small class="text-muted">{{ booking.package.destination.name }}</small>
                                                </div>
                                            </td>
                                            <td>{{ booking.travel_date }}</td>
                                            <td>{{ booking.number_of_travelers }}</td>
                                            <td><strong>${{ booking.total_price }}</strong></td>
                                            <td>
                                                {% if booking.status == 'pending' %}
                                                    <span class="badge bg-warning status-badge">Pending</span>
                                                {% elif booking.status == 'confirmed' %}
                                                    <span class="badge bg-success status-badge">Confirmed</span>
                                                {% elif booking.status == 'cancelled' %}
                                                    <span class="badge bg-danger status-badge">Cancelled</span>
                                                {% elif booking.status == 'completed' %}
                                                    <span class="badge bg-info status-badge">Completed</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a href="{% url 'bookings:booking_detail' booking.id %}" class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    {% if booking.status == 'pending' %}
                                                        <form method="post" action="{% url 'bookings:cancel_booking' booking.id %}" class="d-inline">
                                                            {% csrf_token %}
                                                            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to cancel this booking?')">
                                                                <i class="fas fa-times"></i>
                                                            </button>
                                                        </form>
                                                    {% endif %}
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-calendar-times text-muted" style="font-size: 3rem;"></i>
                                <h5 class="mt-3">No bookings yet</h5>
                                <p class="text-muted">Start your journey by exploring our travel packages</p>
                                <a href="{% url 'bookings:package_list' %}" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Browse Packages
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        {% if user_bookings %}
        <div class="row mt-4">
            <div class="col-md-3 mb-3">
                <div class="card bg-primary text-white text-center">
                    <div class="card-body">
                        <i class="fas fa-calendar-check mb-2" style="font-size: 2rem;"></i>
                        <h4>{{ user_bookings.count }}</h4>
                        <p class="mb-0">Total Bookings</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-success text-white text-center">
                    <div class="card-body">
                        <i class="fas fa-check-circle mb-2" style="font-size: 2rem;"></i>
                        <h4>{{ user_bookings|length }}</h4>
                        <p class="mb-0">Confirmed</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-warning text-white text-center">
                    <div class="card-body">
                        <i class="fas fa-clock mb-2" style="font-size: 2rem;"></i>
                        <h4>{{ user_bookings|length }}</h4>
                        <p class="mb-0">Pending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-info text-white text-center">
                    <div class="card-body">
                        <i class="fas fa-dollar-sign mb-2" style="font-size: 2rem;"></i>
                        <h4>${{ total_spent|default:"0" }}</h4>
                        <p class="mb-0">Total Spent</p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<style>
    .form-control {
        border-radius: 8px;
        border: 1px solid #ddd;
        padding: 10px 15px;
    }
    
    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .table th {
        border-top: none;
        font-weight: 600;
    }
    
    .btn-group .btn {
        margin-right: 2px;
    }
</style>
{% endblock %}
